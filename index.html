<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Options Insights</title>
    
    <!-- Tailwind CSS -->
    <script src="lib/tailwind.min.js"></script>
    
    <!-- D3.js -->
    <script src="lib/d3.v7.min.js"></script>
    <script src="lib/d3-sankey.min.js"></script>
    
    <!-- Custom Styles -->
    <link rel="stylesheet" href="css/styles.css">
</head>
<body class="bg-background text-text-primary font-sans">
    <!-- Header -->
    <header id="main-header" class="bg-surface border-b border-border px-6 py-4 transition-all duration-300">
        <div class="max-w-[1920px] mx-auto">
            <div class="flex items-center justify-between">
                <div id="header-title-section">
                    <h1 class="text-2xl font-semibold">My Option Insights</h1>
                    <p id="header-subtitle" class="transition-all duration-300">Your personal options trading insights dashboard. Fully Private. Your data stays on your system. No Tracking or Cookies.</p>
                </div>
                <div class="flex gap-2 items-center justify-end">
                    <!-- Theme Toggle Button -->
                    <button id="theme-toggle-btn" class="icon-btn" aria-label="Toggle theme">
                        <svg id="theme-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                        </svg>
                    </button>
                    
                    <!-- Actions Menu -->
                    <div class="relative">
                        <button id="actions-menu-btn" class="icon-btn" aria-label="Actions menu" aria-expanded="false">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="5" r="1"/><circle cx="12" cy="12" r="1"/><circle cx="12" cy="19" r="1"/>
                            </svg>
                        </button>
                        <div id="actions-menu" class="actions-menu hidden">
                            <button id="menu-demo-data-btn" class="menu-item">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/>
                                </svg>
                                Load Demo Data
                            </button>
                            <button id="menu-upload-btn" class="menu-item">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/>
                                </svg>
                                Upload CSV
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- File Upload Zone (Hidden by default) -->
    <div id="upload-zone" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center">
        <div class="bg-surface border border-border rounded-lg p-8 max-w-md w-full mx-4">
            <h2 class="text-xl font-semibold mb-4">Upload Trade Data</h2>
            <div id="drop-zone" class="border-2 border-dashed border-border rounded-lg p-8 text-center hover:border-accent transition-colors cursor-pointer">
                <p class="text-text-secondary mb-2">Drag and drop CSV file here</p>
                <p class="text-sm text-text-secondary mb-4">or</p>
                <label for="file-input" id="browse-btn" class="btn-secondary inline-block cursor-pointer">Browse Files</label>
                <input type="file" id="file-input" accept=".csv" style="position: absolute; opacity: 0; pointer-events: none; width: 0; height: 0;" aria-label="Select CSV file">
            </div>
            <button id="close-upload-btn" class="btn-secondary w-full mt-4">Cancel</button>
        </div>
    </div>

    <!-- Loading Spinner -->
    <div id="loading-spinner" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center">
        <div class="bg-surface border border-border rounded-lg p-8">
            <div class="spinner"></div>
            <p class="text-center mt-4">Processing CSV...</p>
        </div>
    </div>

    <!-- Toast Notification Container -->
    <div id="toast-container" class="fixed top-4 right-4 z-50 space-y-2" role="alert" aria-live="polite"></div>

    <!-- Main Content -->
    <main class="max-w-[1920px] mx-auto px-6 py-6">
        <!-- Empty State -->
        <div id="empty-state" class="bg-surface border border-border rounded-lg p-12 text-center">
            <h2 class="text-xl font-semibold mb-2">No Trade Data Available</h2>
            <p class="text-text-secondary mb-6">Upload a CSV file to get started with your trading analytics</p>
            <div class="flex gap-4 justify-center">
                <button id="empty-state-demo-btn" class="btn-secondary">Load Demo Data</button>
                <button id="empty-state-upload-btn" class="btn-primary">Upload CSV</button>
            </div>
        </div>

        <!-- Dashboard Container (Hidden until data loaded) -->
        <div id="dashboard" class="hidden">
            <!-- Tab Navigation -->
            <div class="bg-surface border border-border rounded-lg mb-6">
                <nav class="flex border-b border-border" role="tablist" aria-label="Dashboard sections">
                    <button id="tab-overview" class="tab-btn active" role="tab" aria-selected="true" aria-controls="tab-panel-overview">
                        Overview
                    </button>
                    <button id="tab-analysis" class="tab-btn" role="tab" aria-selected="false" aria-controls="tab-panel-analysis">
                        Analysis
                    </button>
                    <button id="tab-strategies" class="tab-btn" role="tab" aria-selected="false" aria-controls="tab-panel-strategies">
                        Strategies
                    </button>
                    <button id="tab-data" class="tab-btn" role="tab" aria-selected="false" aria-controls="tab-panel-data">
                        Data
                    </button>
                </nav>
            </div>

            <!-- Filters Section - Collapsible -->
            <section class="bg-surface border border-border rounded-lg mb-6 overflow-hidden" role="region" aria-label="Filters">
                <button id="filters-toggle" class="w-full flex items-center justify-between p-4 hover:bg-opacity-50 transition-colors" aria-expanded="false" aria-controls="filters-content">
                    <div class="flex items-center gap-2">
                        <svg id="filters-icon" class="w-5 h-5 transition-transform duration-300" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                        </svg>
                        <span class="font-semibold">Filters</span>
                        <span id="filters-summary" class="text-sm text-text-secondary">All Time â€¢ All Positions</span>
                    </div>
                </button>
                <div id="filters-content" class="filters-collapsible">
                    <div class="p-4 pt-0">
                        <div class="flex flex-wrap gap-6 items-center">
                            <!-- Date Range Filter -->
                            <div class="filter-group">
                                <span class="filter-label">Date Range:</span>
                                <div class="filter-button-group" role="radiogroup" aria-label="Date range selection">
                                    <button class="filter-btn" data-filter="date-range" data-value="last7days" role="radio" aria-checked="false">1W</button>
                                    <button class="filter-btn" data-filter="date-range" data-value="last30days" role="radio" aria-checked="false">1M</button>
                                    <button class="filter-btn" data-filter="date-range" data-value="last12months" role="radio" aria-checked="false">1Y</button>
                                    <button class="filter-btn" data-filter="date-range" data-value="ytd" role="radio" aria-checked="false">YTD</button>
                                    <button class="filter-btn active" data-filter="date-range" data-value="alltime" role="radio" aria-checked="true">All</button>
                                </div>
                            </div>
                            
                            <!-- Position Status Filter -->
                            <div class="filter-group">
                                <span class="filter-label">Position Status:</span>
                                <div class="filter-button-group" role="radiogroup" aria-label="Position status selection">
                                    <button class="filter-btn" data-filter="position-status" data-value="closed" role="radio" aria-checked="false">Closed</button>
                                    <button class="filter-btn" data-filter="position-status" data-value="open" role="radio" aria-checked="false">Open</button>
                                    <button class="filter-btn active" data-filter="position-status" data-value="all" role="radio" aria-checked="true">All</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Tab Panel: Overview -->
            <div id="tab-panel-overview" class="tab-panel" role="tabpanel" aria-labelledby="tab-overview">
                <!-- Summary Metrics Panel (Full Width) -->
                <section class="mb-6" role="region" aria-label="Summary Metrics">
                    <div id="summary-metrics-panel"></div>
                </section>

                <!-- Win/Loss Distribution and Top Underlyings (2 Column Grid) -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                    <section class="bg-surface border border-border rounded-lg p-6" role="region" aria-label="Win Loss Distribution">
                        <h2 class="text-lg font-semibold mb-4">Win/Loss Distribution</h2>
                        <div id="win-loss-donut-chart" class="chart-container" aria-label="Donut chart showing win and loss distribution"></div>
                    </section>
                    <section class="bg-surface border border-border rounded-lg p-6" role="region" aria-label="Top Performing Underlyings">
                        <h2 class="text-lg font-semibold mb-4">Top 5 Underlyings by Win $</h2>
                        <div id="top-underlyings-chart" class="chart-container" aria-label="Bar chart showing top 5 symbols by winning dollars"></div>
                    </section>
                </div>

                <!-- P/L Trend Chart (Full Width) -->
                <section class="bg-surface border border-border rounded-lg p-6 mb-6" role="region" aria-label="Profit and Loss Trend">
                    <h2 class="text-lg font-semibold mb-4">P/L Trend</h2>
                    <div class="chart-container-scrollable">
                        <div id="pl-trend-chart" class="chart-container" aria-label="Line chart showing profit and loss trend over time"></div>
                    </div>
                </section>

            </div>

            <!-- Tab Panel: Analysis -->
            <div id="tab-panel-analysis" class="tab-panel hidden" role="tabpanel" aria-labelledby="tab-analysis">
                <!-- Trade Flow (Sankey Diagram) - Full Width -->
                <section class="bg-surface border border-border rounded-lg p-6 mb-6" role="region" aria-label="Trade Flow">
                    <h2 class="text-lg font-semibold mb-4">Trade Flow</h2>
                    <div class="chart-container-scrollable">
                        <div id="trade-flow-chart" class="chart-container" style="height: 1000px; min-height: 1000px;" aria-label="Sankey diagram showing trade flow from symbols through strategies to outcomes"></div>
                    </div>
                </section>

                <!-- P/L by Symbol (Full Width) -->
                <section class="bg-surface border border-border rounded-lg p-6 mb-6" role="region" aria-label="Profit and Loss by Symbol">
                    <h2 class="text-lg font-semibold mb-4">P/L by Symbol</h2>
                    <div class="chart-container-scrollable">
                        <div id="symbol-pl-chart" class="chart-container" aria-label="Bar chart showing profit and loss by symbol"></div>
                    </div>
                </section>

                <!-- Advanced Visualizations Panel (Full Width) -->
                <section class="mb-6" role="region" aria-label="Advanced Analytics">
                    <div id="advanced-viz-panel"></div>
                </section>
            </div>

            <!-- Tab Panel: Strategies -->
            <div id="tab-panel-strategies" class="tab-panel hidden" role="tabpanel" aria-labelledby="tab-strategies">
                <!-- Win Rate and P/L by Strategy (2 Column Grid) -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                    <section class="bg-surface border border-border rounded-lg p-6" role="region" aria-label="Win Rate by Strategy">
                        <h2 class="text-lg font-semibold mb-4">Win Rate by Strategy</h2>
                        <div id="win-rate-chart" class="chart-container" aria-label="Bar chart showing win rate by strategy"></div>
                    </section>
                    <section class="bg-surface border border-border rounded-lg p-6" role="region" aria-label="Profit and Loss by Strategy">
                        <h2 class="text-lg font-semibold mb-4">P/L by Strategy</h2>
                        <div id="pl-breakdown-chart" class="chart-container" aria-label="Bar chart showing profit and loss by strategy"></div>
                    </section>
                </div>

                <!-- P/L by Symbol & Strategy Table (Full Width) -->
                <div id="symbol-strategy-section-container" role="region" aria-label="Profit and Loss by Symbol and Strategy">
                    <div class="bg-surface border border-border rounded-lg p-6">
                        <h2 class="text-lg font-semibold mb-4">P/L by Symbol & Strategy</h2>
                        <div class="overflow-x-auto">
                            <table id="symbol-strategy-table" class="data-table" role="table">
                                <thead>
                                    <tr>
                                        <th role="columnheader" tabindex="0" class="sortable">Symbol</th>
                                        <th role="columnheader" tabindex="0" class="sortable">Strategy</th>
                                        <th role="columnheader" tabindex="0" class="sortable">Trades</th>
                                        <th role="columnheader" tabindex="0" class="sortable">P/L</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tab Panel: Data -->
            <div id="tab-panel-data" class="tab-panel hidden" role="tabpanel" aria-labelledby="tab-data">
                <section class="bg-surface border border-border rounded-lg p-6">
                    <h2 class="text-lg font-semibold mb-4">Raw Trade Data</h2>
                    <p class="text-text-secondary mb-4">View all imported trades and their details</p>
                    <div class="overflow-x-auto">
                        <table class="data-table" role="table">
                            <tbody>
                                <tr>
                                    <td class="text-center text-text-secondary py-8">No data available</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </section>
            </div>
        </div>
    </main>

    <!-- Application Scripts -->
    <!-- Theme Manager -->
    <script src="js/theme-manager.js"></script>
    <script src="js/theme-colors.js"></script>
    
    <!-- Core Components -->
    <script src="js/tasty-strategy-mapper.js"></script>
    <script src="js/broker-adapters.js"></script>
    <script src="js/csv-parser.js"></script>
    <script src="js/strategy-detector.js"></script>
    <script src="js/analytics-engine.js"></script>
    <script src="js/data-store.js"></script>
    <script src="js/demo-data-generator.js"></script>
    
    <!-- UI Components -->
    <script src="js/tab-manager.js"></script>
    <script src="js/csv-data-viewer.js"></script>
    <script src="js/collapsible-section.js"></script>
    <script src="js/advanced-visualization-panel.js"></script>
    
    <!-- Visualization Components -->
    <script src="js/visualizations/summary-metrics-panel.js"></script>
    <script src="js/visualizations/pl-trend-chart.js"></script>
    <script src="js/visualizations/win-rate-chart.js"></script>
    <script src="js/visualizations/pl-breakdown-chart.js"></script>
    <script src="js/visualizations/symbol-pl-chart.js"></script>
    <script src="js/visualizations/win-loss-donut-chart.js"></script>
    <script src="js/visualizations/top-underlyings-chart.js"></script>
    
    <!-- Advanced Visualization Components -->
    <script src="js/visualizations/heatmap-calendar-chart.js"></script>
    <script src="js/visualizations/scatter-plot-chart.js"></script>
    <script src="js/visualizations/violin-plot-chart.js"></script>
    <script src="js/visualizations/sankey-diagram-chart.js"></script>
    <script src="js/visualizations/bubble-chart.js"></script>
    <script src="js/visualizations/radial-chart.js"></script>
    <script src="js/visualizations/waterfall-chart.js"></script>
    <script src="js/visualizations/horizon-chart.js"></script>
    
    <!-- Dashboard Controller -->
    <script src="js/dashboard-controller.js"></script>
    
    <!-- Main Application Entry Point -->
    <script src="js/main.js"></script>
</body>
</html>
