<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Options Insights</title>
    
    <!-- Tailwind CSS -->
    <script src="lib/tailwind.min.js"></script>
    
    <!-- D3.js -->
    <script src="lib/d3.v7.min.js"></script>
    <script src="lib/d3-sankey.min.js"></script>
    
    <!-- Custom Styles -->
    <link rel="stylesheet" href="css/styles.css">
</head>
<body class="bg-background text-text-primary font-sans">
    <!-- Header -->
    <header class="bg-surface border-b border-border px-6 py-4">
        <div class="max-w-[1920px] mx-auto">
            <div class="flex items-center justify-between">
                <h1 class="text-2xl font-semibold">My Option Insights</h1>
                <p>Your personal options trading analytics dashboard.</p>
                <div class="flex gap-4 items-center">
                    <div id="theme-toggle" class="theme-toggle" role="radiogroup" aria-label="Theme selection">
                        <button id="theme-light" class="theme-btn" data-theme="light" aria-label="Light mode" role="radio" aria-checked="false">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
                        </button>
                        <button id="theme-system" class="theme-btn active" data-theme="system" aria-label="System theme" role="radio" aria-checked="true">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="3" width="20" height="14" rx="2" ry="2"/><line x1="8" y1="21" x2="16" y2="21"/><line x1="12" y1="17" x2="12" y2="21"/></svg>
                        </button>
                        <button id="theme-dark" class="theme-btn" data-theme="dark" aria-label="Dark mode" role="radio" aria-checked="false">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
                        </button>
                    </div>
                    <button id="demo-data-btn" class="btn-secondary" aria-label="Load demo data">
                        Load Demo Data
                    </button>
                    <button id="upload-btn" class="btn-primary" aria-label="Upload CSV file">
                        Upload CSV
                    </button>
                    <button id="reload-btn" class="btn-secondary" aria-label="Reload data">
                        Reload Data
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- File Upload Zone (Hidden by default) -->
    <div id="upload-zone" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center">
        <div class="bg-surface border border-border rounded-lg p-8 max-w-md w-full mx-4">
            <h2 class="text-xl font-semibold mb-4">Upload Trade Data</h2>
            <div id="drop-zone" class="border-2 border-dashed border-border rounded-lg p-8 text-center hover:border-accent transition-colors cursor-pointer">
                <p class="text-text-secondary mb-2">Drag and drop CSV file here</p>
                <p class="text-sm text-text-secondary mb-4">or</p>
                <label for="file-input" id="browse-btn" class="btn-secondary inline-block cursor-pointer">Browse Files</label>
                <input type="file" id="file-input" accept=".csv" style="position: absolute; opacity: 0; pointer-events: none; width: 0; height: 0;" aria-label="Select CSV file">
            </div>
            <button id="close-upload-btn" class="btn-secondary w-full mt-4">Cancel</button>
        </div>
    </div>

    <!-- Loading Spinner -->
    <div id="loading-spinner" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center">
        <div class="bg-surface border border-border rounded-lg p-8">
            <div class="spinner"></div>
            <p class="text-center mt-4">Processing CSV...</p>
        </div>
    </div>

    <!-- Toast Notification Container -->
    <div id="toast-container" class="fixed top-4 right-4 z-50 space-y-2" role="alert" aria-live="polite"></div>

    <!-- Main Content -->
    <main class="max-w-[1920px] mx-auto px-6 py-6">
        <!-- Filters Section -->
        <section class="bg-surface border border-border rounded-lg p-4 mb-6" role="region" aria-label="Filters">
            <div class="flex flex-wrap gap-4 items-center">
                <div class="flex items-center gap-2">
                    <label for="date-range-filter" class="text-sm text-text-secondary">Date Range:</label>
                    <select id="date-range-filter" class="filter-select" aria-label="Select date range">
                        <option value="last7days">Last 7 Days</option>
                        <option value="last30days">Last 30 Days</option>
                        <option value="last12months">Last 12 Months</option>
                        <option value="ytd">Year to Date</option>
                        <option value="alltime" selected>All Time</option>
                    </select>
                </div>
                <div class="flex items-center gap-2">
                    <label for="position-status-filter" class="text-sm text-text-secondary">Position Status:</label>
                    <select id="position-status-filter" class="filter-select" aria-label="Select position status">
                        <option value="closed">Closed Positions</option>
                        <option value="open">Open Positions</option>
                        <option value="all" selected>All Positions</option>
                    </select>
                </div>
            </div>
        </section>

        <!-- Empty State -->
        <div id="empty-state" class="bg-surface border border-border rounded-lg p-12 text-center">
            <h2 class="text-xl font-semibold mb-2">No Trade Data Available</h2>
            <p class="text-text-secondary mb-6">Upload a CSV file to get started with your trading analytics</p>
            <div class="flex gap-4 justify-center">
                <button id="empty-state-demo-btn" class="btn-secondary">Load Demo Data</button>
                <button id="empty-state-upload-btn" class="btn-primary">Upload CSV</button>
            </div>
        </div>

        <!-- Dashboard Container (Hidden until data loaded) -->
        <div id="dashboard" class="hidden">
            <!-- Summary Metrics Panel (Full Width) -->
            <section class="mb-6" role="region" aria-label="Summary Metrics">
                <div id="summary-metrics-panel"></div>
            </section>

            <!-- Trade Flow (Sankey Diagram) - Full Width -->
            <section class="bg-surface border border-border rounded-lg p-6 mb-6" role="region" aria-label="Trade Flow">
                <h2 class="text-lg font-semibold mb-4">Trade Flow</h2>
                <div id="trade-flow-chart" class="chart-container" style="height: 1000px; min-height: 1000px;" aria-label="Sankey diagram showing trade flow from symbols through strategies to outcomes"></div>
            </section>

            <!-- P/L Trend Chart (Full Width) -->
            <section class="bg-surface border border-border rounded-lg p-6 mb-6" role="region" aria-label="Profit and Loss Trend">
                <h2 class="text-lg font-semibold mb-4">P/L Trend</h2>
                <div id="pl-trend-chart" class="chart-container" aria-label="Line chart showing profit and loss trend over time"></div>
            </section>

            <!-- Win Rate and P/L by Strategy (2 Column Grid) -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                <section class="bg-surface border border-border rounded-lg p-6" role="region" aria-label="Win Rate by Strategy">
                    <h2 class="text-lg font-semibold mb-4">Win Rate by Strategy</h2>
                    <div id="win-rate-chart" class="chart-container" aria-label="Bar chart showing win rate by strategy"></div>
                </section>
                <section class="bg-surface border border-border rounded-lg p-6" role="region" aria-label="Profit and Loss by Strategy">
                    <h2 class="text-lg font-semibold mb-4">P/L by Strategy</h2>
                    <div id="pl-breakdown-chart" class="chart-container" aria-label="Bar chart showing profit and loss by strategy"></div>
                </section>
            </div>

            <!-- Win/Loss Distribution and Top Underlyings (2 Column Grid) -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                <section class="bg-surface border border-border rounded-lg p-6" role="region" aria-label="Win Loss Distribution">
                    <h2 class="text-lg font-semibold mb-4">Win/Loss Distribution</h2>
                    <div id="win-loss-donut-chart" class="chart-container" aria-label="Donut chart showing win and loss distribution"></div>
                </section>
                <section class="bg-surface border border-border rounded-lg p-6" role="region" aria-label="Top Performing Underlyings">
                    <h2 class="text-lg font-semibold mb-4">Top 5 Underlyings by Win $</h2>
                    <div id="top-underlyings-chart" class="chart-container" aria-label="Bar chart showing top 5 symbols by winning dollars"></div>
                </section>
            </div>

            <!-- P/L by Symbol (Full Width) -->
            <section class="bg-surface border border-border rounded-lg p-6 mb-6" role="region" aria-label="Profit and Loss by Symbol">
                <h2 class="text-lg font-semibold mb-4">P/L by Symbol</h2>
                <div id="symbol-pl-chart" class="chart-container" aria-label="Bar chart showing profit and loss by symbol"></div>
            </section>

            <!-- Advanced Visualizations Panel (Full Width) -->
            <section class="mb-6" role="region" aria-label="Advanced Analytics">
                <div id="advanced-viz-panel"></div>
            </section>

            <!-- P/L by Symbol & Strategy Table (Full Width) - Collapsible -->
            <div id="symbol-strategy-section-container" role="region" aria-label="Profit and Loss by Symbol and Strategy">
                <div class="overflow-x-auto">
                    <table id="symbol-strategy-table" class="data-table" role="table">
                        <thead>
                            <tr>
                                <th role="columnheader" tabindex="0" class="sortable">Symbol</th>
                                <th role="columnheader" tabindex="0" class="sortable">Strategy</th>
                                <th role="columnheader" tabindex="0" class="sortable">Trades</th>
                                <th role="columnheader" tabindex="0" class="sortable">P/L</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>

    <!-- Application Scripts -->
    <!-- Theme Manager -->
    <script src="js/theme-manager.js"></script>
    <script src="js/theme-colors.js"></script>
    
    <!-- Core Components -->
    <script src="js/tasty-strategy-mapper.js"></script>
    <script src="js/broker-adapters.js"></script>
    <script src="js/csv-parser.js"></script>
    <script src="js/strategy-detector.js"></script>
    <script src="js/analytics-engine.js"></script>
    <script src="js/data-store.js"></script>
    <script src="js/demo-data-generator.js"></script>
    
    <!-- UI Components -->
    <script src="js/collapsible-section.js"></script>
    <script src="js/advanced-visualization-panel.js"></script>
    
    <!-- Visualization Components -->
    <script src="js/visualizations/summary-metrics-panel.js"></script>
    <script src="js/visualizations/pl-trend-chart.js"></script>
    <script src="js/visualizations/win-rate-chart.js"></script>
    <script src="js/visualizations/pl-breakdown-chart.js"></script>
    <script src="js/visualizations/symbol-pl-chart.js"></script>
    <script src="js/visualizations/win-loss-donut-chart.js"></script>
    <script src="js/visualizations/top-underlyings-chart.js"></script>
    
    <!-- Advanced Visualization Components -->
    <script src="js/visualizations/heatmap-calendar-chart.js"></script>
    <script src="js/visualizations/scatter-plot-chart.js"></script>
    <script src="js/visualizations/violin-plot-chart.js"></script>
    <script src="js/visualizations/sankey-diagram-chart.js"></script>
    <script src="js/visualizations/bubble-chart.js"></script>
    <script src="js/visualizations/radial-chart.js"></script>
    <script src="js/visualizations/waterfall-chart.js"></script>
    <script src="js/visualizations/horizon-chart.js"></script>
    
    <!-- Dashboard Controller -->
    <script src="js/dashboard-controller.js"></script>
    
    <!-- Main Application Entry Point -->
    <script src="js/main.js"></script>
</body>
</html>
